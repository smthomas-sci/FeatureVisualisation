<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FeatureVisualisation</title>

    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <link href="stylesheet.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

</head>


<body>

<h1>Improved Feature Visualisation</h1>

<div class="paragraphs">
    <p>
        The drawback of optimising the input image directly is that it creates an image that belongs to a huge
        space of images. This is why we have to add regularises such as jitter and blur and other penalties to
        avoid getting high frequency patterns. What the previous results show is that the main features of a
        class can be generated, but they colours are not representative of what real images would activate
        those classes. There is a need therefore to not just regularise the image pixel-wise but also channel-wise
        to obtain realistic colours.
    </p>

    <div class="regionBlock" style="text-align: center;"><img width=700 src="./possible_volcanos.png">        </div>

    <p>
        The google team have somewhat achieved this for InceptionV1, however, when we use Lucid on other models
        that colours are sometimes correct, and other times, completely incorrect. How can we get colours that work
        for all models?
    </p>
</div>

<div id="regionLabels4">
    <h3 style="display: inline-block; width: 224px;">block5_pool</h3>
    <h3 style="display: inline-block; width: 224px;">Optimal Input</h3>
</div>

<div id="regionWrapper4">
    <div class="regionBlock" id="inputimage_4"></div>
    <div class="regionBlock" id="generated_viewer_4"></div>
</div>


<div id="regionWrapper5">
    <div class="regionBlock" id="inputimage_5"></div>
    <div class="regionBlock" id="generated_viewer_5"></div>
</div>


<div class="paragraphs">



    <p>
        One approach that moves in the right direction is learning an inversion of the features generated by the
        network. This answers the question, how much information about the original image is preserved in the
        feature representations at different layers, but attempting to reconstruct that original image from those
        features. Once we have a learned to map hidden features back to the original image, we have a generator
         that has been trained to generate images in the correct colour range.
    </p>

    <p>
        The following are examples of optimising the space that the block2_pool feature maps represent - (56 x 56 x 128).
        They generator was trained only on the Cats and Dogs data set, however, it contained enough colour variation that
        interestingly benefits this separate task.
    </p>

    <p>
        There does appear to be an artefact of a yellow-ish tone. This is present in all the images. This could be a result
        of "over-cooking" the images which were generated with 3000 steps. Around 2000 steps the effect isn't too obvious.
        This could be a conseqence of only training on the Cats and Dogs data.
    </p>

</div>

<hr style="width: 80%;">

<div id="regionActivations">
    <h2>Region Activations</h2>

    <div id="regionLabels">
        <h3 style="display: inline-block; width: 224px;">block5_pool</h3>
        <h3 style="display: inline-block; width: 224px;">Optimal Input</h3>
        <h3 style="display: inline-block; width: 224px;">Relative Activations</h3>
    </div>

    <div id="regionWrapper">
        <div class="regionBlock" id="inputimage_1"></div>
        <div class="regionBlock" id="generated_viewer_1"></div>
        <div class="regionBlock" style="display: inline-block"><img src="./eagle_activation_mask.png"></div>
    </div>


    <div id="regionLabels2">
        <h3 style="display: inline-block; width: 224px;">block5_pool</h3>
        <h3 style="display: inline-block; width: 224px;">Optimal Input</h3>
        <h3 style="display: inline-block; width: 224px;">Relative Activations</h3>
    </div>

    <div id="regionWrapper2">
        <div class="regionBlock" id="inputimage_2"></div>
        <div class="regionBlock" id="generated_viewer_2"></div>
        <div class="regionBlock" style="display: inline-block"><img src="./golden_activation_mask.png"></div>
    </div>


    <div id="regionLabels3">
        <h3 style="display: inline-block; width: 224px;">block5_pool</h3>
        <h3 style="display: inline-block; width: 224px;">Optimal Input</h3>
        <h3 style="display: inline-block; width: 224px;">Relative Activations</h3>
    </div>

    <div id="regionWrapper3">
        <div class="regionBlock" id="inputimage_3"></div>
        <div class="regionBlock" id="generated_viewer_3"></div>
        <div class="regionBlock" style="display: inline-block"><img src="./black_dog_activation_mask.png"></div>
    </div>



</div>

<hr style="width: 80%;">

<h2>Average Images</h2>

<div class="paragraphs">
    <p>
        The following uses 10 images of a class and averages them. The average image is then sent through
        the network and the activations at block2_pool are then used as the initialisation. The following
        examples are for <strong>Bald Eagle</strong>, <strong>Tree Frog</strong>, <strong>Strawberry</strong>
        and <strong>Tabby Cat</strong>.
    </p>
</div>

<div>
<!--    <h3 style="display: inline-block;"> Average Bald Eagle</h3>-->
<!--    <h3 style="display: inline-block;"> Optimised Image</h3>-->
    <div class="regionBlock" style="display: inline-block; width: 224px;">Average Image</div>
    <div class="regionBlock" style="display: inline-block; width: 224px;">Optimised Image</div>

    <br>
    <div class="regionBlock" style="display: inline-block"><img src="./Average_Images/avg_eagle.jpg"></div>
    <div class="regionBlock" style="display: inline-block"><img src="./Average_Images/avg_eagle.png"></div>

    <br>
    <div class="regionBlock" style="display: inline-block"><img src="./Average_Images/avg_treefrog.jpg"></div>
    <div class="regionBlock" style="display: inline-block"><img src="./Average_Images/avg_treefrog.png"></div>

    <br>
    <div class="regionBlock" style="display: inline-block"><img src="./Average_Images/avg_strawberry.jpg"></div>
    <div class="regionBlock" style="display: inline-block"><img src="./Average_Images/avg_strawberry.png"></div>

    <br>
    <div class="regionBlock" style="display: inline-block"><img src="./Average_Images/avg_tabby.jpg"></div>
    <div class="regionBlock" style="display: inline-block"><img src="./Average_Images/avg_tabby.png"></div>

</div>

<hr style="width: 80%;">

<h2>Class Activations</h2>

<div class="paragraphs">
    <p>
        The following are whole class activations from the "predictions" layer of VGG16.
    </p>
</div>


<div style="margin: auto; width: 700px">

    <div class="class_images" ><img width=128 src="./block2_classes/african_elephant.png">        </div>
    <div class="class_images" ><img width=128 src="./block2_classes/black_swan.png">              </div>
    <div class="class_images" ><img width=128 src="./block2_classes/bordercollie.png">            </div>
    <div class="class_images" ><img width=128 src="./block2_classes/chain.png">                   </div>
    <div class="class_images" ><img width=128 src="./block2_classes/chimpanzee.png">              </div>
    <div class="class_images" ><img width=128 src="./block2_classes/eagle.png">                   </div>
    <div class="class_images" ><img width=128 src="./block2_classes/flamingo.png">                </div>
    <div class="class_images" ><img width=128 src="./block2_classes/gold_fish.png">               </div>
    <div class="class_images" ><img width=128 src="./block2_classes/golden_retriever.png">        </div>
    <div class="class_images" ><img width=128 src="./block2_classes/gorilla.png">                 </div>
    <div class="class_images" ><img width=128 src="./block2_classes/great_white_shark.png">       </div>
    <div class="class_images" ><img width=128 src="./block2_classes/ground_beetle.png">           </div>
    <div class="class_images" ><img width=128 src="./block2_classes/lemon.png">                   </div>
    <div class="class_images" ><img width=128 src="./block2_classes/school_bus.png">              </div>
    <div class="class_images" ><img width=128 src="./block2_classes/schooner.png">                </div>
    <div class="class_images" ><img width=128 src="./block2_classes/scuba.png">                   </div>
    <div class="class_images" ><img width=128 src="./block2_classes/strawberry.png">              </div>
    <div class="class_images" ><img width=128 src="./block2_classes/sunglasses.png">              </div>
    <div class="class_images" ><img width=128 src="./block2_classes/suspension_bridge.png">       </div>
    <div class="class_images" ><img width=128 src="./block2_classes/traffic_light.png">           </div>
    <div class="class_images" ><img width=128 src="./block2_classes/tree_frog.png">               </div>
    <div class="class_images" ><img width=128 src="./block2_classes/violin.png">                  </div>
    <div class="class_images" ><img width=128 src="./block2_classes/volcano.png">                 </div>
    <div class="class_images" ><img width=128 src="./block2_classes/water_ouzel.png">             </div>
    <div class="class_images" ><img width=128 src="./block2_classes/wolf_spider.png">             </div>
</div>                                                                                            </body>

<div id="footer">

</div>



<!-- SCRIPTS -->
<script>
    $(window).load(function() {
        $(".loader").fadeOut("slow");
    });
</script>

<script>

    // STRING FUNCTIONS

    String.prototype.format = function() {
        a = this;
        for (k in arguments) {
            a = a.replace("{" + k + "}", arguments[k])
        }
        return a
    }

    function toTitleCase(str) {
        return str.replace(/\w\S*/g, function(txt){
            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        });
    }


</script>



<script>

    target_div = document.getElementById("inputimage_1");
    for(var i=0; i < 7; i++){
        for (var j=0; j < 7; j++){
            let tile = document.createElement('img');

            tile.id = "(" + i + "," + j + ")";
            tile.className = "dog_tile_1";
            tile.src = "./eagle_7x7_gen_block2/{0}_{1}_eagle.png".format(i, j);
            target_div.appendChild(tile);
        }
    }

    target_div = document.getElementById("inputimage_2");
    for(var i=0; i < 7; i++){
        for (var j=0; j < 7; j++){
            let tile = document.createElement('img');

            tile.id = "(" + i + "," + j + ")";
            tile.className = "dog_tile_2";
            tile.src = "./golden_retriever_7x7_gen_block2/{0}_{1}_golden.png".format(i, j);
            target_div.appendChild(tile);
        }
    }

    target_div = document.getElementById("inputimage_3");
    for(var i=0; i < 7; i++){
        for (var j=0; j < 7; j++){
            let tile = document.createElement('img');

            tile.id = "(" + i + "," + j + ")";
            tile.className = "dog_tile_3";
            tile.src = "./black_german_shepherd_7x7_gen_block2/{0}_{1}_dog.png".format(i, j);
            target_div.appendChild(tile);
        }
    }

    target_div = document.getElementById("inputimage_4");
    for(var i=0; i < 7; i++){
        for (var j=0; j < 7; j++){
            let tile = document.createElement('img');

            tile.id = "(" + i + "," + j + ")";
            tile.className = "dog_tile_4";
            tile.src = "./eagle_lucid/eagle_2_128_rainbow/{0}_{1}_eagle.png".format(i, j);
            target_div.appendChild(tile);
        }
    }

    target_div = document.getElementById("inputimage_5");
    for(var i=0; i < 7; i++){
        for (var j=0; j < 7; j++){
            let tile = document.createElement('img');

            tile.id = "(" + i + "," + j + ")";
            tile.className = "dog_tile_5";
            tile.src = "./eagle_lucid/eagle_2_224_lucid/{0}_{1}_eagle.png".format(i, j);
            target_div.appendChild(tile);
        }
    }


</script>


<script>

    let arrSum = function(arr){
        return arr.reduce(function(a,b){
            return a + b
        }, 0);
    }

    var updateBar = function(data, tile){
        var contrib_div = $("#contributions").children();

        // Get the key for the object
        locations = tile.attr('id').split(",");
        var i = locations[0].substring(1);
        var j = locations[1].substring(0, locations[1].length-1);

        // Update each histogram iteratively
        var filters = data["({0}, {1})".format(i, j)];
        for (var k = 0; k < 5; k++) {

            // Select the kth element
            var bar = contrib_div[k];

            // Find respective width and filter index
            var width = (filters["values"][k] / arrSum(filters["values"]) * 500) + "px";
            var indx = "" + filters["indices"][k];
            bar.getElementsByTagName("rect")[0].setAttribute("width", width);
            bar.getElementsByTagName("text")[0].innerHTML = indx;

        }
    };


    $(".dog_tile_1").on({

            mouseenter:function(){
                var locations = $(this).attr('id').split("_")[0];
                locations = locations.split(",");
                var i = locations[0].substring(1);
                var j = locations[1].substring(0, locations[1].length-1);
                // console.log(i, j);
                $("#generated_viewer_1").css("background-image", "url(" + "./eagle_7x7_gen_block2/{0}_{1}_eagle.png".format(i, j) + ")");
            }
        }
    )

    $(".dog_tile_2").on({

            mouseenter:function(){
                var locations = $(this).attr('id').split("_")[0];
                locations = locations.split(",");
                var i = locations[0].substring(1);
                var j = locations[1].substring(0, locations[1].length-1);
                // console.log(i, j);
                $("#generated_viewer_2").css("background-image", "url(" + "./golden_retriever_7x7_gen_block2/{0}_{1}_golden.png".format(i, j) + ")");
            }
        }
    )

    $(".dog_tile_3").on({

            mouseenter:function(){
                var locations = $(this).attr('id').split("_")[0];
                locations = locations.split(",");
                var i = locations[0].substring(1);
                var j = locations[1].substring(0, locations[1].length-1);
                // console.log(i, j);
                $("#generated_viewer_3").css("background-image", "url(" + "./black_german_shepherd_7x7_gen_block2/{0}_{1}_dog.png".format(i, j) + ")");
            }
        }
    )


    $(".dog_tile_4").on({

            mouseenter:function(){
                var locations = $(this).attr('id').split("_")[0];
                locations = locations.split(",");
                var i = locations[0].substring(1);
                var j = locations[1].substring(0, locations[1].length-1);
                // console.log(i, j);
                $("#generated_viewer_4").css("background-image", "url(" + "./eagle_lucid/eagle_2_128_rainbow/{0}_{1}_eagle.png".format(i, j) + ")");
            }
        }
    )


    $(".dog_tile_5").on({

            mouseenter:function(){
                var locations = $(this).attr('id').split("_")[0];
                locations = locations.split(",");
                var i = locations[0].substring(1);
                var j = locations[1].substring(0, locations[1].length-1);
                // console.log(i, j);
                $("#generated_viewer_5").css("background-image", "url(" + "./eagle_lucid/eagle_2_224_lucid/{0}_{1}_eagle.png".format(i, j) + ")");
				$("#generated_viewer_5").css("background-size", "100% 100%");
            }
        }
    )



</script>

<script>

    $(".class_images").on({

            mouseenter:function(){

                // Destination
                var target = $(this);

                // Create label
                let label = document.createElement('div');

                // Get the name of the image/class
                var child = $(this).children();
                var split = child[0]['src'].split("/");
                var name = toTitleCase(split[split.length-1].split(".")[0].replace("_", " ").replace("_", " "));

                // Add label info
                label.id = "temp_label";
                label.className = "class_label";
                label.innerHTML = name;
                target.append(label);
            },

        mouseleave:function(){
            $("#temp_label").remove();
        }
    });

</script>



</body>
</html>
